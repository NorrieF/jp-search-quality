# JP Search Quality Report (Project 1)

## Data and Method
- Data source: synthetic search/click logs generated by `scripts/generate_synthetic_logs.py`
- Storage: SQLite database `data/jp_search_quality.db`
- Metrics pipeline:
  - `sql/schema.sql` creates tables
  - `sql/metrics_build.sql` builds metric tables and helper views
  - `scripts/export_metrics.sh` exports summary CSVs to `reports/metrics_outputs/`

Primary tables:
- `search_events` (one row per search)
- `click_events` (one row per click)
- `content_catalog` (catalog entities used in simulation)

Primary metric outputs (exported):
- `m_overall.csv`
- `m_by_vertical.csv`
- `m_by_device.csv`
- `m_by_script_flags.csv`
- `m_by_len_bucket.csv`
- `m_top_bad_queries.csv`
- `m_reformulation_drivers.csv`
- `m_daily.csv`

## Executive Summary
Key findings from the JP market simulation:
1) Search quality degrades significantly for romaji queries (higher zero-results, lower CTR).
2) Half-width kana (low volume) shows elevated failure rates, suggesting normalization/indexing gaps.
3) Longer queries show worse outcomes, consistent with intent-modifier noise (e.g., lyrics, latest).
4) Ambiguous head terms (e.g., “hero”, “green”) are overrepresented among high-failure normalized queries.

## Findings

### Overall
See `reports/metrics_outputs/m_overall.csv`.

Interpretation guide:
- zero_results_rate: inability to retrieve
- ctr: ability to attract clicks
- no_click_with_results: relevance mismatch or unsupported intent
- sat_click_rate: proxy satisfaction (max dwell >= 30s)
- reformulation_rate: friction signal

### Breakdown by Vertical
See `m_by_vertical.csv`.
- Compare music vs tv vs podcast to identify market-specific pain points.

### JP Script Behavior
See `m_by_script_flags.csv`.
- Focus segments:
  - JP-only scripts (kanji/kana) baseline performance
  - romaji present segments
  - half-width kana present segments

Hypothesis candidates:
- romaji handling: insufficient aliasing / normalization / transliteration coverage
- half-width kana: normalization/indexing mismatch

### Query Length
See `m_by_len_bucket.csv`.
- Longer queries are likely to include intent modifiers.
- Consider intent detection or query understanding features for common suffix patterns.

### Top Problem Queries
See `m_top_bad_queries.csv`.
- Use this as an “action list” for investigations:
  - disambiguation strategy for ambiguous terms
  - vertical routing (music vs tv vs podcast)
  - alias expansion for mixed-script entity queries

### Reformulation Drivers
See `m_reformulation_drivers.csv`.
- If reformulation spikes after zero-results or no-click, prioritize retrieval vs ranking fixes accordingly.

### Daily Trend
See `m_daily.csv`.
- Useful to show stability of metrics and to simulate regression monitoring.

## Executive Summary
### 1. Overall
10.22% zero-results and 26.74% no-click-with-results indicate both retrieval coverage gaps and relevance/intent mismatch.
### 2. JP script effect
Japanese-script-only queries (kanji/kana) perform best (5.42% zero-results, 70.09% CTR).
### 3. Romaji penalty
Any romaji presence correlates with materially worse outcomes (≈13% zero-results, ≈58–59% CTR).
### 4. Half-width kana
Low volume but high failure rates, suggesting a normalization/indexing gap for legacy character forms.

### Top issues surfaced by query-level diagnostics

Ambiguous head terms (e.g., “hero”, “green”) show elevated zero-results and high no-click-with-results rates, suggesting disambiguation and vertical routing opportunities.

Mixed-script entity queries (romaji + JP) perform worse than canonical JP-only forms, indicating normalization/alias coverage gaps for romanization and mixed-script matching.

Intent-modifier queries (official/lyrics/finale/latest) show high no-click-with-results rates, consistent with user intent not being satisfied by the returned result set.

### Hypotheses

Romanization normalization is incomplete or asymmetric (index-time vs query-time).

Alias coverage insufficient for common JP artist/title variants and mixed-script patterns.

Ambiguous head terms need intent clarification and/or diversified result presentation.

Some modifiers reflect unsupported intent types (lyrics/official video), leading to dissatisfaction.

### Suggested experiments / fixes

Expand and validate JP alias dictionaries, especially for top entities and mixed-script pairs.

Add transliteration normalization and ensure parity between indexing and query processing.

Implement ambiguity handling for head terms (query suggestions, vertical blend, or disambiguation UI).

Detect common intent modifiers (歌詞, 公式, 最新, 最終回) and route to appropriate content types or clarify to user.

